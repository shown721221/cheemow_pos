# Cheemow POS 系統 🛍️💕

## ⚠️ 開發提醒（近期）
- 準備實作「收據系統」：交易保存、列表檢視、基本統計
- 準備實作「匯出功能」：商品清單/收據/彙總 CSV 匯出
- 匯入為取代模式＋PIN 防呆（目前 PIN：0203）

## 開發指導原則
不要做太多的預測，隨著我的指令執行。若是有不錯的建議，等執行完我的要求再提出。

## 專案概述
Cheemow POS 是一個專為平板設計的橫向銷售點系統，具有溫馨可愛的界面設計。

## 🎯 專案定位與技術方針

### 核心原則

### 技術決策理念

## 🚀 最新進度更新 (2025年9月9日)

### 本日重點增強
1. 匯出圖片（營收 / 熱門度）統一存放於每日日期資料夾：`Downloads/cheemow_pos/YYYY-MM-DD/`
2. 收據清單新增「退貨」篩選籤（顯示為 `退貨`），並在每筆列表項目顯示該筆總金額（含預購 / 折扣計算後）。
3. 新增「設定零用金」功能（💰）：
   - 透過功能選單操作
   - 變更需輸入 PIN（目前：`0203`）
   - 零用金顯示於營收匯出圖片日期下方（方便人工對帳）
4. 全面將原本 `NT$` 顯示改為統一貨幣符號 `💲`（付款、收據、輸入框、匯出圖片等）。
5. 數字鍵盤樣式統一：付款、預購 / 折扣價格輸入、零用金設定共用一致視覺與按鍵佈局。
6. 價格顯示色彩規則：
   - 折扣：橘色
   - 預購：紫色
   - 其他（含零用金）：blueGrey
7. 修正方法簽名調整後的執行期例外（冷啟後正常）。
8. 記錄當前環境版本與 Commit 以利跨裝置同步。

### 快速版本 / Commit 快照
| 項目 | 值 |
| ---- | --- |
| Commit Hash | `cc90d4d` |
| Flutter | 3.35.3 (stable) |
| Dart | 3.9.2 |
| Engine | 672c59cfa8 |
| Framework Revision | a402d9a437 |
| SDK constraint (`pubspec.yaml`) | `^3.9.0` |
| 保護 PIN | `0203` |

### 匯出路徑說明
Android（MediaStore）：`Downloads/cheemow_pos/<YYYY-MM-DD>/`
Desktop / 其他：於使用者下載資料夾下建立相同結構。

### 零用金（Petty Cash）說明
- 目的：記錄每日起始現金 / 找零準備金，協助盤點。
- 存儲：SharedPreferences。
- 變更流程：功能選單 → 輸入 PIN → 自訂數字鍵盤輸入金額。
- 顯示：營收統計區（日期下方）與匯出圖片。

### 待可能優化（尚未實作）
- 金額千分位統一格式化。
- Emoji 若裝置不支援時的替代圖示策略。
- 數字鍵盤抽象為可重用元件。
- 增補零用金與匯出流程的測試。

---

### 結帳體驗與付款介面
   - 新增自訂數字鍵盤（避免平板系統鍵盤無法輸入）
   - 動態「快速金額」三顆，依 50/100/500/1000 進位，永遠取最大三個
   - 快速金額平均分散排列
   - 找零顯示改為「� 金額」，並靠右與金額間距 8px
   - 單行三鍵：現金 / 轉帳 / LinePay（預留圖片/QR 顯示區）
   - 使用 Material bag 圖示（跨裝置顯示穩定）

### 修正

### 下一步：收據系統（本地 + 後續擴充）

### �🔍 搜尋功能大升級 - 「搜尋奇妙寶貝」✨

#### 已完成功能：
1. **雙分頁設計**
   - 銷售分頁：原有商品瀏覽和購物車功能 (購物車圖示)
   - 搜尋分頁：全新快速篩選功能 (放大鏡圖示)

2. **18個智慧快速篩選按鈕** (6行 × 3列，自適應空間)
   - **地區篩選**：東京Disney限定、上海Disney限定、香港Disney限定
     - 🔒 **互斥邏輯**：只能選擇一個地區，選中後其他地區按鈕會禁用變灰
   - **角色篩選**：Duffy、Gelatoni、OluMel、ShellieMay、StellaLou、CookieAnn、LinaBell、其他角色
   - **類型篩選**：娃娃、站姿、坐姿、其他吊飾
   - **庫存篩選**：有庫存
   - **功能按鈕**：重選（清除所有）、確認（執行篩選）

3. **UI/UX 優化**
   - 移除搜尋頁面下方的放大鏡提示圖示，增加按鈕可用空間
   - 按鈕使用 Expanded 充分利用螢幕空間，更適合平板操作
   - 禁用按鈕有明確視覺回饋（灰色顯示）
   - 圓角設計更現代化

4. **智慧篩選演算法**
   - 地區篩選檢查商品名稱包含「XX迪士尼限定」關鍵字
   - 多重條件組合篩選
   - 特殊商品優先排序（預約 > 折扣 > 普通）

### 🔧 技術實現亮點

## 🎯 歷史完成功能
   - 特殊商品優先排序（預約 > 折扣 > 普通）

### 🔧 技術實現亮點


## 🎯 歷史完成功能

### 核心 POS 功能 ✅

### 商品管理 ✅
  1. 特殊商品（預約奇妙 → 祝您有奇妙的一天）
  2. 已結帳商品（按結帳時間降序）
  3. 其他商品（按名稱排序）

### 用戶體驗優化 ✅

### 技術架構 ✅

## 🔧 已知問題

### Samsung Galaxy Tab A9+ 特有問題

## 📋 功能選單架構

已建立完整的功能選單框架（右上角 ⋮ 圖標）：

### 已實現 ✅

### 待開發 🚧

## 🚀 下一步開發計劃

### 優先級 1 - 核心功能完善
1. **匯出功能** - 實現商品資料匯出為 CSV
2. **收據系統** - 儲存和查看交易記錄
3. **營收統計** - 基本的銷售統計功能

### 優先級 2 - 功能增強
1. **商品搜尋** - 在商品列表中搜尋特定商品
2. **庫存管理** - 庫存警示和管理
3. **備份恢復** - 資料備份和恢復功能

### 優先級 3 - 進階功能
1. **多店鋪支援** - 支援多個分店
2. **雲端同步** - 資料雲端備份
3. **更多統計報表** - 詳細的銷售分析

## 🏗️ 技術架構說明

### 核心組件
```
lib/
├── main.dart                 # 應用程式入口點
├── config/
│   └── app_config.dart       # 全域配置（橫向鎖定等）
├── models/
│   ├── product.dart          # 商品資料模型
│   └── cart_item.dart        # 購物車項目模型
├── screens/
│   └── pos_main_screen.dart  # 主 POS 畫面
├── widgets/
│   ├── product_list_widget.dart    # 商品列表組件
│   ├── shopping_cart_widget.dart   # 購物車組件
│   └── price_display.dart          # 價格顯示組件
└── services/
    ├── local_database_service.dart    # 本地資料庫服務
    ├── bluetooth_scanner_service.dart # 掃描器服務
    └── csv_import_service.dart        # CSV 匯入服務
```

### 關鍵技術決策
1. **系統級鍵盤監聽** - 使用 `ServicesBinding.instance.keyboard.addHandler()` 避免焦點問題
2. **StatefulWidget 滾動控制** - ProductListWidget 改為 StatefulWidget 支援滾動控制
3. **商品時間追蹤** - 使用 `lastCheckoutTime` 欄位實現智能排序

## 🔄 Git 工作流程

### 分支策略

### 提交規範
```
✨ feat: 新功能
🐛 fix: 修復 bug
📝 docs: 文件更新
🎨 style: 樣式調整
♻️ refactor: 重構
🚀 perf: 性能優化
```

## 🖥️ 開發環境設置

### Windows 環境（已完成）
1. Flutter SDK
2. VS Code + Flutter 插件
3. Git

### Mac 環境（待設置）
```bash
# 1. Clone 專案
git clone https://github.com/shown721221/cheemow_pos.git
cd cheemow_pos

# 2. 安裝依賴
flutter pub get

# 3. 執行開發模式
flutter run

# 4. 建立 Release 版本
flutter build apk --release
```

## 📱 測試裝置

## 💡 設計理念
這個 POS 系統不只是功能性工具，更注重使用者體驗和情感連結：

## 🤖 AI 協作紀錄

### 最後開發狀態（2025年9月9日）

已完成今日重點列表（見上）。系統目前支援：
- 收據列表多條件篩選（含退貨）與總金額顯示。
- 匯出營收 / 熱門度圖片（每日資料夾歸檔）。
- 零用金設定（PIN 保護）並參與人工對帳參考（不併入銷售總額運算邏輯）。
- 預購 / 折扣 / 一般 / 零用金 價格視覺標識統一。
- 貨幣符號統一為 `💲`。

後續若需接續開發，建議優先：
1. 加入金額格式化與測試。
2. README 補充收據資料結構與匯出流程圖。
3. 鍵盤元件化減少重複碼。

### AI 助手續接指南
如果需要 AI 助手繼續協助開發，請參考以下關鍵資訊：

1. **專案特色**：
   - 購物車排序：最新項目在上方（由下往上）
   - 商品列表：智能排序（特殊商品 → 最近結帳 → 其他）
   - 空購物車：❤️ 帶寶寶回家吧 ❤️
   - 結帳後自動滾動到商品列表頂部

2. **技術重點**：
   - 使用系統級鍵盤事件處理條碼掃描
   - ProductListWidget 是 StatefulWidget 支援滾動控制
   - 商品有 lastCheckoutTime 欄位用於排序

3. **待開發功能**：選單中的匯出、收據、營收功能


## 📞 聯絡資訊


*備註：這個 README 會隨著開發進度持續更新*
